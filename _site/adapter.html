<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>LowlaDB Documentation</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="css/lowladocs.css" rel="stylesheet">
    <link href="css/syntax.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="container">

      <!-- Static navbar -->
      <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">LowlaDB</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li id="navqs"><a href="qs.html">Quick Start</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Clients<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="browser.html">Browser</a></li>
                  <li><a href="#">Command Line</a></li>
                </ul>
              </li>
			  <li id="navsyncer"><a href="syncer.html">Syncer</a></li>
              <li id="navadapter"><a href="adapter.html">Adapter</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>

      <!-- Main component -->
      <div class="jumbotron">
		  <h2>LowlaDB Adapter</h2>
		  <p>Adapters allow LowlaDB to connect to almost any back-end database or application.</p>
      </div>
	  
	  <div class="container">
		  <div class="row">
			  <nav class="col-sm-3 bs-docs-sidebar">
				  
				  <ul class="nav nav-stacked fixed">
	<li>
		<a href="#Intro">Introduction</a>
	</li>
	<li>
		<a href="#Install">Installation</a>
	</li>
	<li>
		<a href="#Spec">Specification</a>
		<ul class="nav nav-stacked">
			<li><a href="#SpecDefs">Definitions</a></li>
			<li><a href="#SpecPull">Pull</a></li>
			<li><a href="#SpecPush">Push</a></li>
		</ul>
	</li>
	<li>
		<a href="#API">API</a>
	</li>
</ul>
				  
			  </nav>
			  <div class="col-sm-9">
				  <p><a name="Intro"></a></p>

<h2 id="introduction">Introduction</h2>
<p>LowlaDB adapters provide a common interface to a wide variety of back-end databases and applications. The interface to adapters has been designed to be as simple as possible to implement on a wide variety of systems.</p>

<p>LowlaDB includes a default implementation of adapters for MongoDB and PostgreSQL that can be embedded within a Node.js application. These implementations are built around a common Node.js API. The easiest way to implement an adapter is to take advantage of this API, but it is also possible to create an adapter directly from the specification if you want to use a platform other than Node.js.</p>

<p><a name="Spec"></a></p>

<h2 id="specification">Specification</h2>
<p>The LowlaDB client, syncer and adapter all communicate via a simple HTTP-based protocol. This section defines the parts of the protocol that an adapter must implement.</p>

<p><a name="SpecDefs"></a></p>

<h4 id="definitions">Definitions</h4>
<dl>
  <dt>ID</dt>
  <dd>A text identifier that uniquely identifies a document. IDs are generated by adapters and, for new records created remotely, by clients. An id created by a client must contain sufficient information for the adapter to be able to create the corresponding document in the correct location.</dd>
  <dt>Version</dt>
  <dd>A text identifier for a particular version of a document. Versions are only ever compared for equality, they do not need to support any kind of ordering. The only requirement is that the version must change when a document changes. Typical implementations include</dd>
</dl>

<ul>
  <li>an increasing counter</li>
  <li>a hash of the document</li>
  <li>a timestamp
Versions are always generated by adapters.</li>
</ul>

<dl>
  <dt>Sequence</dt>
  <dd>An increasing counter maintained by the syncer to order modifications and identify changes that have occurred since a client last synced.</dd>
  <dt>ClientNs</dt>
  <dd>Client namespace, i.e., the database and collection where a document should be stored on the client. This is expressed in the usual MongoDB form <code>db.collection</code> where collection may itself contain embedded periods.</dd>
</dl>

<p><a name="SpecPull"></a></p>

<h4 id="pull">Pull</h4>
<p>The pull stage of synchronization ‘pulls’ modified records from the adapter down to the client. The client begins this process by retrieving the list of modified ids from the syncer. For each id, the client verifies whether it already has the correct version of the document. If not, it adds the id to the list of ids that need to be pulled. Once it has collected sufficient ids, it requests the documents by making a POST request to the adapter at the endpoint</p>

<p><code>
/lowla/pull
</code></p>

<p>with a json body in the form</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="err">...</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>The adapter should generate a response of the form</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clientNs&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;clientNs&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;deleted&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="err">|</span><span class="kc">false</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="err">//</span> <span class="err">Document</span> <span class="err">JSON</span>
  <span class="p">},</span>
  <span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="p">]</span></code></pre></div>

<h5 id="notes">Notes</h5>
<ul>
  <li>The response consists of an array of javascript objects. The objects <em>usually</em> alternate between objects containing metadata and objects giving actual document contents. The exception to this is that when the metadata object has <code>deleted: true</code>, there is no following document and the next object, if any, will again be metadata.</li>
  <li>For performance or scalability reasons, the adapter need not return all of the requested documents. The client will re-request any ids that were not returned. This continues until the adapter returns an empty response (i.e., an array containing no objects.) At this point the client will move on to any remaining ids that need to be pulled. However, the client will be unable to update its sync sequence in this situation and it will request these documents again the next time it retrieves a list of modifications from the syncer.</li>
  <li>As long as pulls are successful, the client will update its sync sequence as it pulls documents. Thus if a sync terminates before the client can retrieve all the modifications provided by the syncer, the client is able to resume from where it left off on the next sync.</li>
</ul>

<p><a name="SpecPush"></a></p>

<h4 id="push">Push</h4>
<p>The push stage of synchronization ‘pushes’ modified records from the client directly up to the adapter. The client collects the necessary change data and then makes a POST request to the adapter at the endpoint</p>

<p><code>
/_lowla/push
</code></p>

<p>with a request body of the form</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;documents&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;_lowla&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">,</span>
        <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;version&gt;&quot;</span><span class="p">,</span>
        <span class="nt">&quot;deleted&quot;</span><span class="p">:</span> <span class="kc">true</span> <span class="p">[</span><span class="err">optional</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&quot;ops&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;fieldToModify&quot;</span><span class="p">:</span> <span class="s2">&quot;newvalue&quot;</span><span class="p">,</span>
          <span class="err">...</span>
        <span class="p">},</span>
        <span class="nt">&quot;$unset&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;fieldToDelete&quot;</span><span class="p">:</span> <span class="s2">&quot;dummyvalue&quot;</span><span class="p">,</span>
          <span class="err">...</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="err">...</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></div>

<p>The adapter should generate a response of the form</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;version&gt;&quot;</span>
    <span class="s2">&quot;clientNs&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;clientNs&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;deleted&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="err">|</span><span class="kc">false</span><span class="p">,</span>
	<span class="nt">&quot;clientId&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;id that was pushed&gt;&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="err">//</span> <span class="err">Document</span> <span class="err">JSON</span>
  <span class="p">},</span>
  <span class="p">{</span><span class="err">...</span><span class="p">}</span>
<span class="p">]</span></code></pre></div>

<h5 id="notes-1">Notes</h5>
<ul>
  <li>The response consists of an array of javascript objects. The objects <em>usually</em> alternate between objects containing metadata and objects giving actual document contents. The exception to this is that when the metadata object has <code>deleted: true</code>, there is no following document and the next object, if any, will again be metadata.</li>
  <li>The client may not (and usually will not) include all modifications in a single push request.</li>
  <li>For performance or scalability reasons, the adapter need not return responses for all of the pushed documents. The client will re-push any documents that were not returned. This continues until the adapter returns an empty response (i.e., an array containing no objects.) At this point the client will move on to any remaining ids that need to be pushed. However, the client will push these documents again the next time it performs a push sync.</li>
  <li>If the client is not able to generate suitable ids for new documents, the adapter may return a record using a different id than the value that was pushed. In this case, the original id will be returned in the metadata in the <code>clientId</code> property. If this property is set, the client should delete the original document under the old id and insert the returned document under the new id.</li>
  <li>The adapter <em>must</em> eventually provide a response for every document pushed. It can choose to reject a document by returning <code>deleted: true</code> in the metadata, but it cannot simply ignore a document as the client will continue to push it until it receives a response.</li>
  <li>It is the job of the adapter to handle conflicts when a document is edited in multiple places. It can detect conflicts by comparing the version on an incoming document with the current version in the back-end. For most applications a simple strategy suffices such as always accepting the incoming document or always rejecting the incoming document. In either case, the adapter must send the document that it ultimately stored in the back-end back to the client.</li>
</ul>

<h2 id="api">API</h2>
<p><a name="API"></a></p>

			  </div>
		  </div>
	  </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script type="text/javascript">
		$("#navadapter").addClass("active");
	</script>
	
  </body>
</html>

